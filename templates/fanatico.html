{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}


{% block cssblock %}

		<style type="text/css">
			.ivo-pregunta { height: auto;}
			.ivo-form  select {width: 100%}
		</style>
{% endblock %}

{% block content %}


		<!-- Intro -->
		<div class="container-fluid ivo-pregunta" style="background-image: url({% static 'img/pregunta2.jpg' %});">
			<div class="container">
				<div class="row" style="margin-bottom: 20px;">
					<div class="col-md-6 col-lg-6">
						<h1>Reg&iacute;strate en nuestra plataforma</h1>
					</div>
				</div>
				<div class="row" style="margin-bottom: 50px;">
					<div class="col-md-10 col-lg-10 col-md-offset-1 text-center">
						<a id="fb-fan" href="#" class="ivo-boton-fondo ivo-form-fanBot">
							<span>Registrate con facebook</span>
						</a>
					</div>
				</div>
                <div class="row">
                    <div class="col-md-10 col-lg-10 col-md-offset-1 text-center">
                        <a onclick="handleSignInClick()" href="#" class="ivo-boton-fondo ivo-form-gooBot">
                            <span>Registrate con google&nbsp&nbsp&nbsp&nbsp&nbsp</span>
                        </a>
                    </div>
                </div>
				<div class="row" style="margin: 40px 0 10px;">
					<div class="col-md-10 col-lg-10 col-md-offset-1">
						<div class="ivo-form-avisoFan">
							<h5>
								<span>O utilizando tu correo electr&oacute;nico</span>
							</h5>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-8 col-lg-8 col-md-offset-2">

					<!-- Formulario -->
						<form method="POST" class="ivo-form ivo-form-registro" id="ivo-form-registro" action="/registro/fan/">
							
							<input type="hidden" name="genero" id="genero" required="required">
		                    <input type="hidden" name="fecha_nacimiento" id="fecha_nacimiento">                    
		                    <input type="hidden" name="tipo_usuario" value="F">

							<div class="row">
								<div class="col-md-6 col-lg-6">
									<input type="text" name="first_name" mensaje="{% trans 'Nombre es un campo requerido' %}"
                                   placeholder="{% trans 'Nombre' %}" required = "required" id='nombre' >
								</div>
								<div class="col-md-6 col-lg-6">
									<input type="text" name="last_name" mensaje="{% trans 'Apellido es un campo requerido' %}"
                                   placeholder="{% trans 'Apellido' %}" required = "required" id='apellido'>
								</div>
							</div>
							<div class="row">
								<div class="col-md-12 col-lg-12">
									<h4>Redes Sociales</h4>
								</div>
							</div>
							<div class="row">
								<div class="col-md-6 col-lg-6">
									<div class="ivo-social-form">
										<span class="social_facebook_circle"></span>
									</div>
									<input type="text" name="facebook" class="social">
								</div>
								<div class="col-md-6 col-lg-6">
									<div class="ivo-social-form">
										<span class="social_twitter_circle"></span>
									</div>
									<input type="text" name="twitter" class="social">
								</div>
								<div class="col-md-6 col-lg-6 col-md-offset-3">
									<div class="ivo-social-form">
										<span class="social_instagram_circle"></span>
									</div>
									<input type="text" name="instagram" class="social" >
								</div>
							</div>

					<div class="row">
                        <div class="col-md-12 col-lg-12">
                            <div class="ivo-mensajes-select">
                                <div class="dropdown ivo-drop-formulario">
                                    
									<select name="interes" placeholder="{% trans 'Interes' %}" >
                                    <option selected="selected" disabled>Interes</option>
                                    {%for interes in intereses %}
                                        <option value='{{interes.id}}'> {{interes.nombre}}</option>
                                    {%endfor%}
                                	</select>

                                </div>
                            </div>
                        </div>

					</div>


	

						<div class="row">
								<div class="col-md-6 col-lg-6">
									<input type="text" name="usuario" placeholder="Usuario">
								</div>
								<div class="col-md-6 col-lg-6">
									<div class="row text-center">
                                <div class="col-xs-12 col-sm-12 col-md-4 hidden-md hidden-lg text-left">
                                    {% trans "Sexo" %}:
                                </div>
                                <div class="col-xs-3 col-sm-3 col-md-4">
                                    <input type="checkbox" id="checkbox-2-1" genero = "M" class="regular-checkbox big-checkbox" />
                                    <label for="checkbox-2-1"></label>
                                    <h5>{% trans "Hombre" %}</h5>
                                </div>
                                <div class="col-xs-3 col-sm-3 col-md-4">
                                    <input type="checkbox" id="checkbox-2-2" genero = "F" class="regular-checkbox big-checkbox" />
                                    <label for="checkbox-2-2"></label>
                                    <h5>{% trans "Mujer" %}</h5>
                                </div>
                            </div>
							</div>
						</div>
							<div class="row" >
								<div class="col-md-6 col-lg-6" >
									<div>Fecha de Nacimiento</div>
									<input class="fechad" type="text" id="fecha_dia" minlength="2" maxlength="2"
                                   onkeypress="return soloNumeros(event)" required = "required"
                                   mensaje="{% trans 'Día de la fecha es un campo requerido' %}">
                            <div class="resaltar-separador">/</div>
                            <input class="fechad" type="text" id="fecha_mes" minlength="2" maxlength="2"
                                   onkeypress="return soloNumeros(event)" required = "required"
                                   mensaje="{% trans 'Mes de la fecha es un campo requerido' %}">
                            <div class="resaltar-separador">/</div>
                            <input class="fechay" type="text" id="fecha_a_o" minlength="4" maxlength="4"
                                   onkeypress="return soloNumeros(event)" required = "required"
                                   mensaje="{% trans 'Año de la fecha es un campo requerido' %}">
								</div>
								<div class="col-md-6 col-lg-6">
								<input class="margin-20" type="email" name="email" placeholder="{% trans 'Correo Electrónico' %} " required = "required"
                                   mensaje="{% trans 'Email es un campo requerido' %}">
									
								</div>
							</div>
							<div class="row">
								<div class="col-md-6 col-lg-6">
									<input type="password" name="password1" id="password1" placeholder="Confirmar Clave" autosave="false" autocomplete="false">
								</div>
								<div class="col-md-6 col-lg-6">
									<input type="password" name="password2" id="password2" placeholder="Clave" autocomplete="false" autosave="false" >
								</div>
							</div>



							<div class="row" style="margin:50px 0;">
								<div class="col-sm-1 col-md-1 col-md-offset-3">
                                <input type="checkbox" name="terminos" id="checkbox-terminos" value="1" class="regular-checkbox">
                                <label for="checkbox-terminos"></label>
                            </div>
								<div class="col-sm-6 col-md-6 " style="text-align: center;">
									<a href="/terminos/" target="_blank"><i>Leer Terminos y Condiciones</i></a>
								</div>
							</div>
                    <div class="row">
                        <div class="col-md-6 col-lg-6 col-md-offset-3" style="text-align: center;">
                            <a class="ivo-boton-fondoInpt ivo-borde-trs-verde" id="btn_registrar" style="cursor: pointer">
                                <span class="ivo-back-trs-verde ivo-borde-transparente">Registrar</span>
                            </a>
                        </div>
                    </div>
							 {% csrf_token %}
						</form>
						<!-- Fin Formulario -->

						
					</div>
				</div>
			</div>
		</div>
{% endblock %}

{% block javascript %}
<script>
    var cantidad_seleccion_tanlento = 0;
    $(function(){
        //getTalentos();
        $('#ivo-form-registro').submit(function(){
            return false;
        });
       $('input[type=checkbox]').click(function(){



            if($(this).attr('genero')){
                $('input[type=checkbox]').removeAttr('checked');
                $(this).prop("checked", "checked");
                $('#genero').val($(this).attr('genero'));
            }


        });
        /*$(document).on('click', 'input[type=checkbox]',function(){
            if($(this).attr('name') == 'artes'){
                if(cantidad_seleccion_tanlento <= 3){
                    getGenerosArtisticos($(this).val())
                }
            }

        });
        */
      $('#btn_registrar').click(function(){

            if( $('#password1').val().trim() != $('#password2').val().trim()){
                //alert(' {% trans 'Las contraseñas no coinciden' %} ')
                $('#texto_mensaje').text('Las contraseñas no coinciden');
                $('#mensajes').modal('show');
                return false;
            }
          
            if (!$('#checkbox-terminos').is(':checked') ||  $('#password1').val().trim() != $('#password2').val().trim() || $('#password1').val().trim()=='' || $('#password2').val().trim()=='' || $('#fecha_a_o').val() < 1900 || $('#fecha_a_o').val() > new Date().getFullYear() || $('#nombre').val().trim()=='' || $('#apellido').val().trim()==''){


                if($('#nombre').val().trim()==''){
                    $('#texto_mensaje').text('El campo Nombre es obligatorio');
                $('#mensajes').modal('show');
                return false;    
            }
            if($('#apellido').val().trim()==''){
                    $('#texto_mensaje').text('E campo Apellido es obligatorio');
                $('#mensajes').modal('show');
                return false;    
            }

                 if( !$('#checkbox-terminos').is(':checked') ) {
                //alert('Debe aceptar los terminos y condiciones');
                $('#texto_mensaje').text('Debe aceptar los terminos y condiciones');
                $('#mensajes').modal('show');
                return false;
            }
            
            if( $('#password1').val().trim()=='' || $('#password2').val().trim()==''){
                //alert(' {% trans 'el campo contraseña es requerido' %} ')
                $('#texto_mensaje').text('el campo contraseña es requerido');
                $('#mensajes').modal('show');
                return false;
            }
            if( $('#password1').val().trim().length<8 || $('#password2').val().trim().length<8){
                //alert(' {% trans 'el campo contraseña debe ser mayor a ocho caracteres' %} ')
                $('#texto_mensaje').text('el campo contraseña \ndebe ser mayor a ocho caracteres');
                $('#mensajes').modal('show');
                return false;
            }
            
            if( $('#fecha_a_o').val() < 1900 || $('#fecha_a_o').val() > new Date().getFullYear()){
                //alert(' {% trans 'el campo contraseña debe ser mayor a ocho caracteres' %} ')
                $('#texto_mensaje').text('Ingrese un año valido');
                $('#mensajes').modal('show');
                return false;            
            }

            
            
            }else{

                if(validarForm($('#ivo-form input'))){
                    $('#fecha_nacimiento').val($('#fecha_a_o').val()+"-"+$('#fecha_mes').val()+'-'+$('#fecha_dia').val());
        registrar();    
                
            }else{
                console.log('false');
            }
            }
           

            
            
        });
    })


function registrar(){

 NProgress.start();
        $.ajax({
            url: '/registro/fan/',
            type: 'post',
            dataType: 'json',
            data:  $('#ivo-form-registro').serialize(),
            success: function (data) {
                NProgress.done();
                if(data.success == false){
                    //alert(data.mensaje);
                    $.each(data.errors.fields, function(i, item) {
                        //alert(item);
                        $('#texto_mensaje').text(i+' '+item);
                        $('#mensajes').modal('show');
                    });
                }else{
                   $('#texto_mensaje').text(data.mensaje);
                    $('#mensajes').modal('show');
                    setTimeout(function(){
                      location.href  ='/perfil/configuraciongeneral/'
                    }, 1500);

                }
            }
        });
    }

     $('#fb-fan').click(function(){
                FB.login(function(response) {
                  if (response.status === 'connected') {
                    // Logged into your app and Facebook.
                    console.log('Welcome!  Fetching your information.... ');
                        FB.api('/me?fields=first_name, last_name, id, picture, gender, email,name', function(response) {
                           console.log(response)
                            
                                 var genero='';
                              if (response.gender=='male'){
                                genero='M';
                              }else{
                                genero='F';
                              };
                            

                           $.ajax({
                            url: '/facebook-registro/',
                            type: 'post',
                            dataType: 'json',
                            data: {'first_name':response.first_name,'last_name':response.last_name,'genero':genero ,'tipo_usuario':'F','name':response.name,'email':response.email,'picture':'http:///graph.facebook.com/'+response.id+'/picture?type=large', 'csrfmiddlewaretoken':'{{csrf_token}}'},
                            success: function (data) {
                                if(data.success == false){
                                     $('#texto_mensaje').text('no se pudo crear la cuenta');
                                     $('#mensajes').modal('show');
                                  }else{
                                    
                                   
                                   
                                      location.href  ='/perfil/configuraciongeneral/'
                                        
                                                  
                                                                      
                                }
                            }
                        });
                              
                        });

                  } else {
                    // The person is not logged into this app or we are unable to tell.
                  }
                },{scope:'email'});

        })

 $('#facebook').click(function(){
                FB.login(function(response) {
                  if (response.status === 'connected') {
                    // Logged into your app and Facebook.
                    console.log('Welcome!  Fetching your information.... ');
                        FB.api('/me?fields=first_name, last_name, id, picture, gender, email,name', function(response) {
                           console.log(response)
                            
                                 var genero='';
                              if (response.gender=='male'){
                                genero='M';
                              }else{
                                genero='F';
                              };
                            

                           $.ajax({
                            url: '/facebook-login/',
                            type: 'post',
                            dataType: 'json',
                            data: {'first_name':response.first_name,'last_name':response.last_name,'gender':response.gender ,'tipo_usuario':'F','name':response.name,'email':response.email,'picture':'http:///graph.facebook.com/'+response.id+'/picture?type=large', 'csrfmiddlewaretoken':'{{csrf_token}}'},
                            success: function (data) {
                                if(data.success == false){
                                     $('#texto_mensaje').text('Ud no posee cuenta de usuario');
                                     $('#mensajes').modal('show');
                                  }else{
                                    
                                   
                                   
                                      location.href  ='/artistadashboard/'
                                        
                                                  
                                                                      
                                }
                            }
                        });
                              
                        });

                  } else {
                    // The person is not logged into this app or we are unable to tell.
                  }
                },{scope:'email'});

        })

function updateSigninStatus(isSignedIn) {
        // When signin status changes, this function is called.
        // If the signin status is changed to signedIn, we make an API call.
        if (isSignedIn) {
          makeApiCallReg('F');
        }
      }

        function handleSignInClick(event) {
        // Ideally the button should only show up after gapi.client.init finishes, so that this
        // handler won't be called before OAuth is initialized.
        gapi.auth2.getAuthInstance().signIn();
      }

</script>


{% endblock javascript %}